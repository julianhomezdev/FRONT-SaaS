<div class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Crear Factura</h2>
            <button class="close-btn" (click)="close()">&times;</button>
        </div>

        <div class="form-section">
            <h3>Datos del Cliente</h3>
            <div class="form-group">
                <label>Nombre del Cliente *</label>
                <input type="text" [(ngModel)]="customerName">
            </div>

            <div class="form-group">
                <label>Documento *</label>
                <input type="text" [(ngModel)]="customerDocument">
            </div>
        </div>

        <div class="form-section">
    <h3>Productos</h3>
    <div class="add-item">
        <!-- Selector de producto -->
        <select [(ngModel)]="selectedProductId" (change)="onProductChange()">
            <option value="0">Selecciona un producto</option>
            <option *ngFor="let product of products" [value]="product.id">
                {{ product.productName }} - ${{ product.productPrice | number }}
            </option>
        </select>

        <!-- Selector de talla -->
        <select 
            [(ngModel)]="selectedSizeId" 
            [disabled]="!selectedProduct"
        >
            <option value="0">Selecciona una talla</option>
            <option 
                *ngFor="let size of selectedProduct?.sizes" 
                [value]="size.sizeId"
            >
                {{ size.sizeName }} (Stock: {{ size.sizeStock }})
            </option>
        </select>

        <!-- Cantidad -->
        <input 
            type="number" 
            [(ngModel)]="quantity"
            [max]="getAvailableStock()"
            min="1"
            placeholder="Cantidad"
        >

        <button type="button" (click)="addItem()">Agregar</button>
    </div>

    <table *ngIf="items.length > 0">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Talla</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
                <th>Total</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let item of items; let i = index">
                <td>{{ item.productName }}</td>
                <td>{{ item.sizeName }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.unitPrice | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
                <td>{{ item.total | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
                <td>
                    <button type="button" (click)="removeItem(i)">‚ùå</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>
        <div class="totals-section">
            <p>Subtotal: {{ subtotal | currency }}</p>
            <p>IVA (19%): {{ tax | currency }}</p>
            <p class="total">TOTAL: {{ total | currency }}</p>
        </div>

        <div class="form-actions">
    <button type="button" (click)="close()">Cancelar</button>
    <button 
        type="button" 
        (click)="createInvoice()" 
        [disabled]="loading || items.length === 0"
        [class.loading]="loading"
    >
        {{ loading ? 'Creando...' : 'Crear Factura' }}
    </button>
</div>
    </div>
</div>